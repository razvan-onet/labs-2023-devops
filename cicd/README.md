# Course 6 Support Document

## Overview

The backend, developed in .NET, is responsible for incrementing a counter and storing its value in a MariaDB(MySQL) database.

The frontend consists of a single page featuring a button. When clicked, a POST request is sent to the backend, which responds with the incremented value generated by the button press.

## Backend

The initial step involves creating a GitHub repository to store the code for our .NET application.

To set up the repository, follow these steps:

1. Create a new public GitHub repository named "devops-labs-backend".
2. Open a local terminal or Git Bash in a folder and execute the following commands:
````
git clone git@github.com:razvan-onet/devops-labs-dotnet-backend.git
cd devops-labs-dotnet-backend
rm -r .git
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/yourusername/devops-labs-backend.git
git push -u origin main
````

### Database Setup

1. Connect to your server and create a new Docker network for all containers associated with your application.

`docker network create devopslabs`

2. Once the network is created, execute the following command to set up a MariaDB container with a custom root user password:

`docker run --name mariadb -e MYSQL_ROOT_PASSWORD=v8P1eS1YwU4K1dm --network devopslabs -p 3306:3306 -d mariadb:10.5.12`

### Generate SSH Key Pair

1. Generate an SSH key pair on the server for the GitHub runner to authenticate and execute Docker commands:

`ssh-keygen -t rsa -b 4096`

2. To append the public key (id_rsa.pub) to the authorized_keys file, run the following command:

`cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys`

### CI/CD Setup

1. Add the `.github/workflows/main.yaml` file containing your pipeline configuration to the root folder of the project.
2. Add the necessary secrets to your repository in the "Settings" tab under the "Actions" section.
````
DB_HOST:  mariadb
DB_PASSWORD: The password you provided when starting the MariaDB container (e.g., v8P1eS1YwU4K1dm). 
DB_USERNAME: root
DOCKER_PASSWORD: The password for your Docker Hub account, used to authenticate when pushing and pulling Docker images.
DOCKER_USERNAME: The username for your Docker Hub account, used to authenticate when pushing and pulling Docker images.
HOST: IP address of the server where your application will be deployed. $ curl ifconfig.me
SSH_KEY: The private SSH key used to authenticate and establish a secure connection to the deployment server. Ensure this key is kept secret, as exposing it could compromise the security of your server. $ cat ~/.ssh/id_rsa
SSH_USERNAME: ubuntu
````
3. Commit and push the workflow file to your repository:
````
git add .github/workflows/main.yaml
git commit -m "Add CI/CD workflow file"
git push origin main
````

### Verify Deployment

To verify the proper functioning of your application, access the container by visiting the URL:

`http://<server-ip>:4000/api/counter`


## Frontend

The initial step involves creating a GitHub repository to store the code for our Angular frontend application.

To set up the repository, follow these steps:

1. Create a new public GitHub repository named "devops-labs-frontend".
2. Open a local terminal or Git Bash in a folder and execute the following commands:
````
git clone git@github.com:razvan-onet/devops-labs-angular-frontend.git
cd devops-labs-angular-frontend
rm -r .git
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/yourusername/devops-labs-frontend.git
git push -u origin main
````

### Nginx Setup

To prepare the nginx, execute the following command:

`docker run -p 80:80 --name nginx -v $(pwd)/frontend:/usr/share/nginx/html:ro --network devopslabs -d nginx`

This command performs the following actions:
* Starts a new Docker container named "nginx" using the official Nginx image.
* Maps port 80 of the host to port 80 of the container, enabling external access to the container's web server.
* Mounts the local "frontend" directory (which should contain your Angular application's built files) to the container's default Nginx document root at /usr/share/nginx/html. The :ro flag ensures that the mounted directory is read-only within the container. 
* Connects the container to the "devopslabs" Docker network, which enables communication between the Nginx container and other containers within the same network 
* Runs the container in detached mode (-d), which allows the container to run in the background without blocking your terminal or command prompt


### CI/CD Setup

1. Add the `.github/workflows/main.yaml` file containing your pipeline configuration to the root folder of the project.
2. Add the necessary secrets to your repository in the "Settings" tab under the "Actions" section.
````
HOST: IP address of the server where your application will be deployed.
SSH_KEY: The private SSH key used to authenticate and establish a secure connection to the deployment server. Ensure this key is kept secret, as exposing it could compromise the security of your server. $ cat ~/.ssh/id_rsa
SSH_USERNAME: ubuntu
````
Commit and push the workflow file to your repository:
````
git add .github/workflows/main.yaml
git commit -m "Add CI/CD workflow file"
git push origin main
````

### Verify Deployment
Once the CI/CD process has completed successfully without any errors, your frontend application should be accessible using the server's IP address. If it's properly connected to the backend, you should be able to see the value of the counter on the page.

To access the frontend application, open a web browser and navigate to the server's IP address:

`http://<server-ip>`


